<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zeska Billing - Settings</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background: #f8f9fa; }
    .card { border-radius: 10px; margin-bottom: 15px; }
    .logout-btn { color: red; }
  </style>
</head>
<body class="p-4">

  <div class="container bg-white p-4 shadow rounded">
    <h3 class="text-center mb-4">‚öôÔ∏è Settings</h3>

    <!-- Profile Section -->
    <div class="card p-3 mb-4">
      <h5>User Info</h5>
      <p><b>Email:</b> <span id="userEmail">Loading...</span></p>
      <p><b>UID:</b> <span id="userUID">Loading...</span></p>
      <button class="btn btn-danger logout-btn" onclick="logout()">üö™ Logout</button>
    </div>

    <!-- Admin Controls -->
    <div class="card p-3 mb-4">
      <h5>Admin Controls</h5>
      <button class="btn btn-primary w-100 mb-2" onclick="goProducts()">üì¶ Manage Products</button>
      <button class="btn btn-secondary w-100 mb-2" onclick="goHistory()">üìë Billing History</button>
    </div>

    <!-- General Settings -->
    <div class="card p-3">
      <h5>General Settings</h5>
      <div class="mb-2">
        <label><b>Business Name</b></label>
        <input id="bizName" class="form-control" placeholder="Enter Business Name">
      </div>
      <div class="mb-2">
        <label><b>GST %</b></label>
        <input id="gst" type="number" class="form-control" placeholder="Enter GST %" min="0">
      </div>
      <div class="mb-2">
        <label><b>Default Payment</b></label>
        <select id="defaultPayment" class="form-control">
          <option>UPI 1</option>
          <option>UPI 2</option>
          <option>UPI 3</option>
          <option>Cash</option>
        </select>
      </div>
      <button class="btn btn-success w-100" onclick="saveSettings()">üíæ Save Settings</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCycwfIfSaNsNW8wPqBZL27Z4PJAXB2WIU",
      authDomain: "zeska-billing.firebaseapp.com",
      projectId: "zeska-billing",
      storageBucket: "zeska-billing.firebasestorage.app",
      messagingSenderId: "285841508539",
      appId: "1:285841508539:web:0e7d0b64be33693a4a019e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;

    // ‚úÖ Load user info
    onAuthStateChanged(auth, async (user) => {
      if(user){
        currentUser = user;
        document.getElementById("userEmail").innerText = user.email;
        document.getElementById("userUID").innerText = user.uid;

        // Load settings
        const snap = await getDoc(doc(db,"settings","general"));
        if(snap.exists()){
          let data = snap.data();
          document.getElementById("bizName").value = data.bizName || "";
          document.getElementById("gst").value = data.gst || "";
          document.getElementById("defaultPayment").value = data.defaultPayment || "Cash";
        }
      } else {
        window.location.href = "login.html";
      }
    });

    // ‚úÖ Save settings
    window.saveSettings = async function(){
      let bizName = document.getElementById("bizName").value.trim();
      let gst = parseFloat(document.getElementById("gst").value) || 0;
      let defaultPayment = document.getElementById("defaultPayment").value;

      await setDoc(doc(db,"settings","general"),{
        bizName,gst,defaultPayment
      });

      alert("‚úÖ Settings Saved!");
    };

    // ‚úÖ Logout
    window.logout = async function(){
      await signOut(auth);
      window.location.href="login.html";
    };

    // ‚úÖ Navigation
    window.goProducts=function(){ window.location.href="products.html"; }
    window.goHistory=function(){ window.location.href="view-bills.html"; }
  </script>
</body>
</html>
